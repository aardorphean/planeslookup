<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Tuesday, October 31, 2023, 12:11 PM -->
<!-- MuClient version 5.07-pre -->

<!-- Plugin "Orphean_Planes_Lookup" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Orphean_Planes_Lookup"
   author="orphean"
   id="584b11491af93277a7739c3a"
   language="Lua"
   purpose="Small database to search for planes mobs and navigate to their pools."
   save_state="y"
   date_written="2023-10-31 12:09:04"
   requires="5.07"
   version="1.0"
   >
<description trim="y">
<![CDATA[
pfind [Mob Name]
plookup [Mob Name]  ( Same as pfind )

These two commands are the same and are used to find planes mobs and their pools.

pgo [Result #]

The output of pfind/plookup includes a result number in the left most column. You can pass this number to pgo to run directly to the room vs. clicking the link in the result table.
]]>
</description>

</plugin>


<!--  Aliases  -->

<aliases>
  <alias
   script="orphean_planes_find"
   match="^plookup {1}(.+)$"
   enabled="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  </alias>
  <alias
   script="orphean_planes_find"
   match="^pfind {1}(.+)$"
   enabled="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  </alias>
  <alias
   script="orphean_planes_go"
   match="^pgo {1}([0-9]+)$"
   enabled="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  </alias>
</aliases>

<!--  Script  -->


<script>
<![CDATA[
require "string"
require "math"
require "tprint"

local orphean_planespools = {
  { poollayer = 'Gladsheim',      poolnum = 1,  roomnum = 29365 },
  { poollayer = 'Pandemonium',    poolnum = 2,  roomnum = 29366 },
  { poollayer = 'Hades',          poolnum = 3,  roomnum = 29367 },
  { poollayer = 'Gehenna',        poolnum = 4,  roomnum = 29368 },
  { poollayer = 'Acheron',        poolnum = 5,  roomnum = 29369 },
  { poollayer = 'Twin Paradises', poolnum = 6,  roomnum = 29370 },
  { poollayer = 'Arcadia',        poolnum = 7,  roomnum = 29371 },
  { poollayer = 'Seven Heavens',  poolnum = 8,  roomnum = 29372 },
  { poollayer = 'Elysium',        poolnum = 10, roomnum = 29374 },
  { poollayer = 'Beastlands',     poolnum = 11, roomnum = 29375 },
}

local orphean_planesmobs = {
  { mobname = 'A paladin einheriar',  poolnum = 1 },
  { mobname = 'A psionic einheriar',  poolnum = 1 },
  { mobname = 'A cleric einheriar',   poolnum = 1 },
  { mobname = 'A ranger einheriar',   poolnum = 1 },
  { mobname = 'A warrior einheriar',  poolnum = 1 },
  { mobname = 'A thief einheriar',    poolnum = 1 },
  { mobname = 'A mage einheriar',     poolnum = 1 },
  { mobname = 'A titan',              poolnum = 1 },
  { mobname = 'A per',                poolnum = 1 },
  { mobname = 'A bariaur',            poolnum = 1 },
  { mobname = 'A malelephant',        poolnum = 2 },
  { mobname = 'A nightmare',          poolnum = 2 },
  { mobname = 'A larva',              poolnum = 2 },
  { mobname = 'A hordling',           poolnum = 3 },
  { mobname = 'A yagnoloth',          poolnum = 3 },
  { mobname = 'A night hag',          poolnum = 3 },
  { mobname = 'An ultroloth',         poolnum = 4 },
  { mobname = 'An arcanaloth',        poolnum = 4 },
  { mobname = 'A dergholoth',         poolnum = 4 },
  { mobname = 'A hydroloth',          poolnum = 4 },
  { mobname = 'A mezzoloth',          poolnum = 4 },
  { mobname = 'A psicloth',           poolnum = 4 },
  { mobname = 'A nycaloth',           poolnum = 4 },
  { mobname = 'A vaporighu',          poolnum = 4 },
  { mobname = 'General of Gehenna',   poolnum = 4 },
  { mobname = 'An ultroloth',         poolnum = 5 },
  { mobname = 'A dergholoth',         poolnum = 5 },
  { mobname = 'A hydroloth',          poolnum = 5 },
  { mobname = 'A mezzoloth',          poolnum = 5 },
  { mobname = 'A psicloth',           poolnum = 5 },
  { mobname = 'A nycaloth',           poolnum = 5 },
  { mobname = 'An adamantite dragon', poolnum = 6 },
  { mobname = 'An air sentinel',      poolnum = 6 },
  { mobname = 'A monadic deva',       poolnum = 6 },
  { mobname = 'An agathinon aasimon', poolnum = 7 },
  { mobname = 'An astral deva',       poolnum = 7 },
  { mobname = 'A translator',         poolnum = 7 },
  { mobname = "A t'uen-rin",          poolnum = 7 },
  { mobname = 'A lantern archon',     poolnum = 8 },
  { mobname = 'A tome archon',        poolnum = 8 },
  { mobname = 'A noctral',            poolnum = 8 },
  { mobname = 'A planetar aasimon',   poolnum = 8 },
  { mobname = 'A warden archon',      poolnum = 8 },
  { mobname = 'A hound archon',       poolnum = 8 },
  { mobname = 'A sword archon',       poolnum = 8 },
  { mobname = 'A zoveri',             poolnum = 8 },
  { mobname = 'A light aasimon',      poolnum = 10 },
  { mobname = 'A solar aasimon',      poolnum = 10 },
  { mobname = 'A movanic deva',       poolnum = 10 },
  { mobname = 'A balanea',            poolnum = 10 },
  { mobname = 'A phoenix',            poolnum = 10 },
  { mobname = 'A moon dog',           poolnum = 10 },
  { mobname = 'A mortai',             poolnum = 11 },
  { mobname = 'An animal spirit',     poolnum = 11 },
  { mobname = 'An animal lord',       poolnum = 11 },
  { mobname = 'A warden beast',       poolnum = 11 },
}

local orphean_resultset = {}

---Strips color codes from passed string.
---@param str string
---@return string
local function stripCodes(str)
  local stripped = (str:gsub("@[Xx]%d%d?%d?", ""))
  return (stripped:gsub("@[a-zA-Z]", ""))
end

---Repeats a string a given number of times with an optional border.
---@param item string
---@param times number
---@param border string?
---@return string
local function strrepeat(item, times, border)
  local result = ""
  local borderChar = border and border or ""

  for _ = 1, times do
    result = result .. item
  end

  if (border) then
    result = borderChar .. result:sub(2, #result - 1) .. borderChar
  end

  return result
end

---Centers a string within a given width, an optional fill character,
---and an optional border string.
---@param item string
---@param width number
---@param char string? Defaults to space
---@param border string? Defaults to no border
local function center(item, width, char, border)
  local itemHalfLen = math.ceil(string.len(item) / 2)
  local widthHalfLen = math.ceil((width / 2))
  local itemStart = widthHalfLen - itemHalfLen
  local remainder = width - itemStart - string.len(item)
  local result = ""
  local centerChar = char and char or " "
  local borderChar = border and border or nil

  result = strrepeat(centerChar, itemStart) .. item .. strrepeat(centerChar, remainder)

  if (border) then
    result = borderChar .. result:sub(2, #result - 1) .. borderChar
  end

  return result
end

---Right pads the given string
---@param str string
---@param width number
---@param char? string Defaults to space
---@return string
local function rightpad(str, width, char)
  local char = char and char or " "
  local stripped = stripCodes(str)

  if #stripped == width then
    return str
  end

  if #stripped > width then
    str = stripped:sub(1, width)
  end

  return str .. string.rep(char, width - #stripped)
end

---Left pads the given string
---@param str string
---@param width number
---@param char? string Defaults to space
---@return string
local function leftpad(str, width, char)
  local char = char and char or " "
  local stripped = stripCodes(str)

  if #stripped == width then
    return str
  end

  if #stripped > width then
    str = stripped:sub(1, width)
  end

  return string.rep(char, width - #stripped) .. str
end

function orphean_planes_pool_lookup(poolnumber)
  for _, entry in pairs(orphean_planespools) do
    if entry['poolnum'] == poolnumber then
      return { name = entry["poollayer"], roomnum = entry["roomnum"] }
    end
  end

  return { name = "Unknown", roomnum = -1 }
end

function orphean_planes_find(_name, _line, matches)
  local target = ".*" .. matches[1] .. ".*"
  local width = 80

  Note(strrepeat("_", width))
  Note(center("Planes Mob Lookup", width, " ", "|"))
  Note(strrepeat("-", width))

  local header = "| " .. rightpad("#", 4)
  header = header .. rightpad("Mob Name", 30)
  header = header .. rightpad("Pool <Pool #>", 30)
  header = header .. rightpad("Pool Room", 13)
  header = header .. "|"
  Note(header)

  Note(strrepeat("-", width))

  orphean_resultset = {}
  local count = 1

  for _, entry in ipairs(orphean_planesmobs) do
    if string.match(entry['mobname'], target) then
      local pool = orphean_planes_pool_lookup(entry['poolnum'])
      local row = "| "

      table.insert(orphean_resultset, pool['roomnum'])

      row = row .. rightpad(count .. "", 4)
      count = count + 1
      row = row .. rightpad(entry['mobname'], 30)
      row = row .. rightpad(pool["name"] .. " <run " .. entry['poolnum'] .. "e>", 30)

      Tell(row)
      Hyperlink("mapper goto " .. pool['roomnum'], pool['roomnum'] .. '', "Move to Pool Room", "cyan", "black",
        false)
      Note(leftpad("|", 9))
    end
  end

  Note(strrepeat("-", width, "+"))
end

function orphean_planes_go(_name, _line, matches)
  local target = tonumber(matches[1])

  if type(orphean_resultset[target]) ~= "nil" then
    local room = orphean_resultset[target]
    Execute("mapper goto " .. room)
  else
    Note("Pool Lookup: No such result number.")
  end
end

function OnPluginInstall()
world.Note (world.GetPluginInfo (world.GetPluginID (), 3))
end

]]>
</script>


<!--  Plugin help  -->

<aliases>
  <alias
   script="OnHelp"
   match="Orphean_Planes_Lookup:help"
   enabled="y"
  >
  </alias>
</aliases>

<script>
<![CDATA[
function OnHelp ()
  world.Note (world.GetPluginInfo (world.GetPluginID (), 3))
end
]]>
</script>

</muclient>
